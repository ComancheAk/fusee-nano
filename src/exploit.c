#include <stdio.h>
#include "usb.h"

/* Nintendo Switch RCM Mode VID/PID */
#define APX_VID 0x0955
#define APX_PID 0x7321

#define TIMEOUT 1000 // milliseconds

static void print_hex(unsigned char *buf, int len)
{
	for (int i=0; i<len; i++)
		printf("%02x", buf[i]);
}

int main()
{
	int fd;
	unsigned char devid[16];
	
	fd = get_device(APX_VID, APX_PID);
	if (fd < 0) {
		perror("[-] Failed to open usb device");
		return -1;
	}
	
	if(claim_interface(fd) < 0) {
		perror("[-] Failed to claim interface");
		return -1;
	}
	
	if (ep_read(fd, 1, devid, sizeof(devid), TIMEOUT) != sizeof(devid)) {
		perror("[-] Failed to read device ID");
		return -1;
	}
	
	printf("[*] device id: ");
	print_hex(devid, sizeof(devid));
	printf("\n");
	
	return 0;
}
